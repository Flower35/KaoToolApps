/**************************************************************/
/* "kao_winapi_toolbase/toolbase_kao_mem.c"                   */
/**************************************************************/

#include "toolbase_kao_mem.h"

#include "toolbase_kao_hacks.h"
#include "toolbase_kao.h"

/**
 * @addtogroup ToolBase_Kao_Mem
 * @{
 */


/**************************************************************/
/* Kao Memory :: Public data                                  */
/**************************************************************/

/* ~~~~~~~~~~~~~~~~~~~~~~~~~~ */
KaoOffsets KAO2PL_OFFSETS;

/* ~~~~~~~~~~~~~~~~~~~~~~~~~~ */
KaoOffsets KAO3PL_OFFSETS;

/* ~~~~~~~~~~~~~~~~~~~~~~~~~~ */
KaoOffsets * g_KaoOffsets;


/**************************************************************/
/* Kao Memory :: Public functions                             */
/**************************************************************/

/* ~~~~~~~~~~~~~~~~~~~~~~~~~~ */
VOID
KaoMem_init()
{
  g_KaoOffsets = NULL;

  /* "Kangurek Kao: Runda 2" (retail) */

  KAO2PL_OFFSETS.COMMUNICATOR_ARGS = 0x00641E00;

  KAO2PL_OFFSETS.GLOBAL_LOADING     = 0x0062451C;
  KAO2PL_OFFSETS.GLOBAL_GAMELET     = 0x006267CC;
  KAO2PL_OFFSETS.GLOBAL_BASICSTRING = 0x00607650;
  KAO2PL_OFFSETS.GLOBAL_ARRAY_REF_LEVELDESC = 0x0062B7C8;
  KAO2PL_OFFSETS.GLOBAL_LEVELID     = 0x0062B7D4;

  KAO2PL_OFFSETS.GAMELET_SCENE       = 0x000C;
  KAO2PL_OFFSETS.GAMELET_HERO        = 0x038C;
  KAO2PL_OFFSETS.GAMELET_FLOWCTRL    = 0x30B0;

  KAO2PL_OFFSETS.LEVELDESC_NAME = 0x08;

  KAO2PL_OFFSETS.REFCOUNTER_COUNTER = 0x04;

  KAO2PL_OFFSETS.NODE_PREVXFORM = 0x0008;
  KAO2PL_OFFSETS.NODE_UNUSED    = 0x000C;
  KAO2PL_OFFSETS.NODE_PARENT    = 0x0010;
  KAO2PL_OFFSETS.NODE_NAME      = 0x0014;
  KAO2PL_OFFSETS.NODE_ALBOX     = 0x0018;
  KAO2PL_OFFSETS.NODE_FLAGS     = 0x001C;
  KAO2PL_OFFSETS.NODE_SPHERE    = 0x0020;
  KAO2PL_OFFSETS.NODE_COLLISION = 0x0030;
  KAO2PL_OFFSETS.NODE_VISGROUP  = 0;
  KAO2PL_OFFSETS.NODE_VISCTRL   = 0x0034;
  KAO2PL_OFFSETS.NODE_VISRATE   = 0x0038;
  KAO2PL_OFFSETS.NODE_SIZE      = 0x003C;

  KAO2PL_OFFSETS.GROUP_NODES = 0x003C;
  KAO2PL_OFFSETS.GROUP_SIZE  = 0x0048;

  KAO2PL_OFFSETS.ZONE_BOXBOUNDMIN = 0x0070;
  KAO2PL_OFFSETS.ZONE_BOXBOUNDMAX = 0x007C;

  KAO2PL_OFFSETS.GEOARRAY_DATA   = 0x0008;
  KAO2PL_OFFSETS.GEOARRAY_LENGTH = 0x000C;
  KAO2PL_OFFSETS.GEOARRAY_SIZE   = 0x0010;

  KAO2PL_OFFSETS.GEOMETRY_MATERIAL    = 0x003C;
  KAO2PL_OFFSETS.GEOMETRY_BOXBOUNDMIN = 0x0040;
  KAO2PL_OFFSETS.GEOMETRY_BOXBOUNDMAX = 0x004C;

  KAO2PL_OFFSETS.TRIMESH_GEOSET   = 0x0058;
  KAO2PL_OFFSETS.TRIMESH_MODIFIER = 0;
  KAO2PL_OFFSETS.TRIMESH_SIZE     = 0x005C;

  KAO2PL_OFFSETS.GEOSET_FLAGS           = 0x0008;
  KAO2PL_OFFSETS.GEOSET_VERTEXCOUNT     = 0x000C;
  KAO2PL_OFFSETS.GEOSET_TEXCOORDSCOUNT  = 0x0010;
  KAO2PL_OFFSETS.GEOSET_STRIPSPORTIONS  = 0x0014;
  KAO2PL_OFFSETS.GEOSET_INDICESARRAY    = 0x0018;
  KAO2PL_OFFSETS.GEOSET_VERTICESARRAYS  = 0x001C;
  KAO2PL_OFFSETS.GEOSET_NORMALSARRAYS   = 0x0024;
  KAO2PL_OFFSETS.GEOSET_TEXCOORDSARRAYS = 0x002C;
  KAO2PL_OFFSETS.GEOSET_COLORSARRAY     = 0x003C;
  KAO2PL_OFFSETS.GEOSET_TEXMAPPINGTYPES = 0x0040;
  KAO2PL_OFFSETS.GEOSET_DISPLAYLIST     = 0x0050;
  KAO2PL_OFFSETS.GEOSET_CURRENTSET      = 0x0054;
  KAO2PL_OFFSETS.GEOSET_MODIFIER        = 0x0058;
  KAO2PL_OFFSETS.GEOSET_AABBTREE        = 0x005C;
  KAO2PL_OFFSETS.GEOSET_SIZE            = 0x0060;

  KAO2PL_OFFSETS.BITMAP_VW        = 0x0008;
  KAO2PL_OFFSETS.BITMAP_VH        = 0x000C;
  KAO2PL_OFFSETS.BITMAP_WIDTH     = 0x0010;
  KAO2PL_OFFSETS.BITMAP_HEIGHT    = 0x0014;
  KAO2PL_OFFSETS.BITMAP_BIND      = 0x0018;
  KAO2PL_OFFSETS.BITMAP_PIXELS    = 0x001C;
  KAO2PL_OFFSETS.BITMAP_PAL       = 0x0020;
  KAO2PL_OFFSETS.BITMAP_TYPE      = 0x0024;
  KAO2PL_OFFSETS.BITMAP_PATH      = 0x0028;
  KAO2PL_OFFSETS.BITMAP_UNUSED    = 0x002C;
  KAO2PL_OFFSETS.BITMAP_EVALUATOR = 0x0030;
  KAO2PL_OFFSETS.BITMAP_SIZE      = 0x0034;

  KAO2PL_OFFSETS.TEXTURE_FLAGS  = 0x0008;
  KAO2PL_OFFSETS.TEXTURE_XFORM  = 0x000C;
  KAO2PL_OFFSETS.TEXTURE_BITMAP = 0x0010;
  KAO2PL_OFFSETS.TEXTURE_UNUSED = 0x0014;
  KAO2PL_OFFSETS.TEXTURE_SIZE   = 0x0018;

  KAO2PL_OFFSETS.MATERIAL_TEXTURES    = 0x0008;
  KAO2PL_OFFSETS.MATERIAL_FLAGS       = 0x0014;
  KAO2PL_OFFSETS.MATERIAL_STATE       = 0x0018;
  KAO2PL_OFFSETS.MATERIAL_COLLISION   = 0x001C;
  KAO2PL_OFFSETS.MATERIAL_UNUSED      = 0x0020;
  KAO2PL_OFFSETS.MATERIAL_SOUND       = 0x0022;
  KAO2PL_OFFSETS.MATERIAL_NAME        = 0x0024;
  KAO2PL_OFFSETS.MATERIAL_TRANSPLAYER = 0x0028;
  KAO2PL_OFFSETS.MATERIAL_ALPHAREF    = 0x002C;
  KAO2PL_OFFSETS.MATERIAL_SIZE        = 0x0030;

  KAO2PL_OFFSETS.IC_OBJECT     = 0x0061F134;
  KAO2PL_OFFSETS.IC_NODE       = 0x006245DC;
  KAO2PL_OFFSETS.IC_GROUP      = 0x006248A8;
  KAO2PL_OFFSETS.IC_XFORM      = 0x00624764;
  KAO2PL_OFFSETS.IC_TRIMESH    = 0x00624474;
  KAO2PL_OFFSETS.IC_GEOSET     = 0x00624470;
  KAO2PL_OFFSETS.IC_BITMAP     = 0x00624598;
  KAO2PL_OFFSETS.IC_TEXTURE    = 0x0062459C;
  KAO2PL_OFFSETS.IC_MATERIAL   = 0x00624784;

  KAO2PL_OFFSETS.VPTR_BITMAP          = 0x005D0718;
  KAO2PL_OFFSETS.VPTR_TEXTURE         = 0x005D0760;
  KAO2PL_OFFSETS.VPTR_MATERIAL        = 0x005D0C1C;
  KAO2PL_OFFSETS.VPTR_NODE            = 0x005D08B0;
  KAO2PL_OFFSETS.VPTR_BOXZONE         = 0x005D1880;
  KAO2PL_OFFSETS.VPTR_GROUP           = 0x005D0F88;
  KAO2PL_OFFSETS.VPTR_ENVIRONMENT     = 0x005D0C48;
  KAO2PL_OFFSETS.VPTR_TRANSFORM       = 0x005D0B60;
  KAO2PL_OFFSETS.VPTR_BILLBOARD       = 0x005D1EA8;
  KAO2PL_OFFSETS.VPTR_PROXY           = 0x005D1090;
  KAO2PL_OFFSETS.VPTR_PIVOT           = 0x005D1140;
  KAO2PL_OFFSETS.VPTR_ACTOR           = 0x005D7530;
  KAO2PL_OFFSETS.VPTR_WSGROUP         = 0x005D1728;
  KAO2PL_OFFSETS.VPTR_SCENE           = 0x005D15E0;
  KAO2PL_OFFSETS.VPTR_TRIMESH         = 0x005D0568;
  KAO2PL_OFFSETS.VPTR_GEOSET          = 0x005D0610;
  KAO2PL_OFFSETS.VPTR_GEOARRAY_USHORT = 0x005CFDE0;
  KAO2PL_OFFSETS.VPTR_GEOARRAY_POINT2 = 0x005CFDF8;
  KAO2PL_OFFSETS.VPTR_GEOARRAY_POINT4 = 0x005CDE2C;
  KAO2PL_OFFSETS.VPTR_3FXARRAY        = 0x005CDE2C;

  KAO2PL_OFFSETS.METHOD_MALLOC = 0x00461F40;
  KAO2PL_OFFSETS.METHOD_MFREE  = 0x00461FC0;

  /* "Kao: Tajemnica Wulkanu" (retail) */

  KAO3PL_OFFSETS.COMMUNICATOR_ARGS = 0x00785040;

  KAO3PL_OFFSETS.GLOBAL_LOADING     = 0x00752500;
  KAO3PL_OFFSETS.GLOBAL_GAMELET     = 0x0075C900;
  KAO3PL_OFFSETS.GLOBAL_BASICSTRING = 0x006DE800;
  KAO3PL_OFFSETS.GLOBAL_ARRAY_REF_LEVELDESC = 0x0076BE68;
  KAO3PL_OFFSETS.GLOBAL_LEVELID     = 0x0076BE80;

  KAO3PL_OFFSETS.GAMELET_SCENE       = 0x000C;
  KAO3PL_OFFSETS.GAMELET_HERO        = 0x0388;
  KAO3PL_OFFSETS.GAMELET_FLOWCTRL    = 0x75E0;

  KAO3PL_OFFSETS.LEVELDESC_NAME = 0x08;

  KAO3PL_OFFSETS.REFCOUNTER_COUNTER = 0x04;

  KAO3PL_OFFSETS.NODE_PREVXFORM = 0x0008;
  KAO3PL_OFFSETS.NODE_UNUSED    = 0x000C;
  KAO3PL_OFFSETS.NODE_PARENT    = 0x0010;
  KAO3PL_OFFSETS.NODE_NAME      = 0x0014;
  KAO3PL_OFFSETS.NODE_ALBOX     = 0x0018;
  KAO3PL_OFFSETS.NODE_FLAGS     = 0x001C;
  KAO3PL_OFFSETS.NODE_SPHERE    = 0x0020;
  KAO3PL_OFFSETS.NODE_COLLISION = 0x0030;
  KAO3PL_OFFSETS.NODE_VISGROUP  = 0x0034;
  KAO3PL_OFFSETS.NODE_VISCTRL   = 0x0038;
  KAO3PL_OFFSETS.NODE_VISRATE   = 0x003C;
  KAO3PL_OFFSETS.NODE_SIZE      = 0x0040;

  KAO3PL_OFFSETS.GROUP_NODES = 0x0040;
  KAO3PL_OFFSETS.GROUP_SIZE  = 0x004C;

  KAO3PL_OFFSETS.ZONE_BOXBOUNDMIN = 0x0074;
  KAO3PL_OFFSETS.ZONE_BOXBOUNDMAX = 0x0080;

  KAO3PL_OFFSETS.GEOARRAY_DATA   = 0x0008;
  KAO3PL_OFFSETS.GEOARRAY_LENGTH = 0x000C;
  KAO3PL_OFFSETS.GEOARRAY_SIZE   = 0x0010;

  KAO3PL_OFFSETS.GEOMETRY_MATERIAL    = 0x0040;
  KAO3PL_OFFSETS.GEOMETRY_BOXBOUNDMIN = 0x0044;
  KAO3PL_OFFSETS.GEOMETRY_BOXBOUNDMAX = 0x0050;

  KAO3PL_OFFSETS.TRIMESH_GEOSET   = 0x005C;
  KAO3PL_OFFSETS.TRIMESH_MODIFIER = 0x0060;
  KAO3PL_OFFSETS.TRIMESH_SIZE     = 0x0064;

  KAO3PL_OFFSETS.GEOSET_FLAGS           = 0x0008;
  KAO3PL_OFFSETS.GEOSET_VERTEXCOUNT     = 0x000C;
  KAO3PL_OFFSETS.GEOSET_TEXCOORDSCOUNT  = 0x0010;
  KAO3PL_OFFSETS.GEOSET_STRIPSPORTIONS  = 0x0014;
  KAO3PL_OFFSETS.GEOSET_INDICESARRAY    = 0x0018;
  KAO3PL_OFFSETS.GEOSET_VERTICESARRAYS  = 0x001C;
  KAO3PL_OFFSETS.GEOSET_NORMALSARRAYS   = 0x0024;
  KAO3PL_OFFSETS.GEOSET_TEXCOORDSARRAYS = 0x002C;
  KAO3PL_OFFSETS.GEOSET_COLORSARRAY     = 0x003C;
  KAO3PL_OFFSETS.GEOSET_TEXMAPPINGTYPES = 0x0040;
  KAO3PL_OFFSETS.GEOSET_DISPLAYLIST     = 0x0050;
  KAO3PL_OFFSETS.GEOSET_CURRENTSET      = 0x0054;

  // (...) [0x0058] = 0x0007
  // (...) [0x005C] = 0x0008
  // (...) [0x0060] = 0x000C
  // (...) [0x0064] = 0x0618

  // (...) [0x0068] = 0x071C
  // (...) [0x006C] = 0
  // (...) [0x0070] = 0
  // (...) [0x0074] = 0

  KAO3PL_OFFSETS.GEOSET_MODIFIER      = 0x0078;
  // (...) 0x007C // eGeoArray<ePhyVertex>
  // (...) 0x0080 // e3fXArray (vertices fast copy, refCounter 1)
  // (...) 0x0084 // e3fXArray (normals  fast copy, refCounter 1)

  // (...) 0x0088 0x008C

  KAO3PL_OFFSETS.GEOSET_AABBTREE        = 0x0090;
  KAO3PL_OFFSETS.GEOSET_SIZE            = 0x0094;

  KAO3PL_OFFSETS.BITMAP_VW        = 0x0008;
  KAO3PL_OFFSETS.BITMAP_VH        = 0x000C;
  KAO3PL_OFFSETS.BITMAP_WIDTH     = 0x0010;
  KAO3PL_OFFSETS.BITMAP_HEIGHT    = 0x0014;
  KAO3PL_OFFSETS.BITMAP_BIND      = 0x0018;
  KAO3PL_OFFSETS.BITMAP_PIXELS    = 0x001C;
  KAO3PL_OFFSETS.BITMAP_PAL       = 0x0020;
  KAO3PL_OFFSETS.BITMAP_TYPE      = 0x0024;
  KAO3PL_OFFSETS.BITMAP_PATH      = 0x0028;
  KAO3PL_OFFSETS.BITMAP_UNUSED    = 0x002C;
  KAO3PL_OFFSETS.BITMAP_EVALUATOR = 0x0030;
  KAO3PL_OFFSETS.BITMAP_SIZE      = 0x0034;

  KAO3PL_OFFSETS.TEXTURE_FLAGS  = 0x0008;
  KAO3PL_OFFSETS.TEXTURE_XFORM  = 0x000C;
  KAO3PL_OFFSETS.TEXTURE_BITMAP = 0x0010;
  KAO3PL_OFFSETS.TEXTURE_UNUSED = 0x0014;
  KAO3PL_OFFSETS.TEXTURE_SIZE   = 0x0018;

  KAO3PL_OFFSETS.MATERIAL_TEXTURES    = 0x0008;
  KAO3PL_OFFSETS.MATERIAL_FLAGS       = 0x0014;
  KAO3PL_OFFSETS.MATERIAL_STATE       = 0x0018;
  KAO3PL_OFFSETS.MATERIAL_COLLISION   = 0x001C;
  KAO3PL_OFFSETS.MATERIAL_UNUSED      = 0x0020;
  KAO3PL_OFFSETS.MATERIAL_SOUND       = 0x0022;
  KAO3PL_OFFSETS.MATERIAL_NAME        = 0x0024;
  KAO3PL_OFFSETS.MATERIAL_TRANSPLAYER = 0x0028;
  KAO3PL_OFFSETS.MATERIAL_ALPHAREF    = 0x002C;
  KAO3PL_OFFSETS.MATERIAL_SIZE        = 0x0030;

  KAO3PL_OFFSETS.IC_OBJECT     = 0x007521B4;
  KAO3PL_OFFSETS.IC_NODE       = 0x00752304;
  KAO3PL_OFFSETS.IC_GROUP      = 0x00752780;
  KAO3PL_OFFSETS.IC_XFORM      = 0x007524C4;
  KAO3PL_OFFSETS.IC_TRIMESH    = 0x0075221C;
  KAO3PL_OFFSETS.IC_GEOSET     = 0x00752218;
  KAO3PL_OFFSETS.IC_BITMAP     = 0x00752588;
  KAO3PL_OFFSETS.IC_TEXTURE    = 0x0075258C;
  KAO3PL_OFFSETS.IC_MATERIAL   = 0x007524E8;

  KAO3PL_OFFSETS.VPTR_BITMAP          = 0x00699310;
  KAO3PL_OFFSETS.VPTR_TEXTURE         = 0x00699354;
  KAO3PL_OFFSETS.VPTR_MATERIAL        = 0x006992E4;
  KAO3PL_OFFSETS.VPTR_NODE            = 0x00698DA0;
  KAO3PL_OFFSETS.VPTR_BOXZONE         = 0x0069A9D0;
  KAO3PL_OFFSETS.VPTR_GROUP           = 0x00699898;
  KAO3PL_OFFSETS.VPTR_ENVIRONMENT     = 0x006993B0;
  KAO3PL_OFFSETS.VPTR_TRANSFORM       = 0x00699228;
  KAO3PL_OFFSETS.VPTR_BILLBOARD       = 0x006996F0;
  KAO3PL_OFFSETS.VPTR_PROXY           = 0x00699998;
  KAO3PL_OFFSETS.VPTR_PIVOT           = 0x00699AD4;
  KAO3PL_OFFSETS.VPTR_ACTOR           = 0x006A44EC;
  KAO3PL_OFFSETS.VPTR_WSGROUP         = 0x0069A730;
  KAO3PL_OFFSETS.VPTR_SCENE           = 0x0069A5EC;
  KAO3PL_OFFSETS.VPTR_TRIMESH         = 0x00698BF0;
  KAO3PL_OFFSETS.VPTR_GEOSET          = 0x00698C94;
  KAO3PL_OFFSETS.VPTR_GEOARRAY_USHORT = 0x00698CB0;
  KAO3PL_OFFSETS.VPTR_GEOARRAY_POINT2 = 0x00698CE8;
  KAO3PL_OFFSETS.VPTR_GEOARRAY_POINT4 = 0x00698B1C;
  KAO3PL_OFFSETS.VPTR_3FXARRAY        = 0x00698B34;

  KAO3PL_OFFSETS.METHOD_MALLOC = 0x0042B0E0;
  KAO3PL_OFFSETS.METHOD_MFREE  = 0x0042B160;
}

/* ~~~~~~~~~~~~~~~~~~~~~~~~~~ */
BOOL
KaoMem_commAwake()
{
  BOOL return_value = FALSE;
  DWORD dwordTest;

  KAO_PUT_DWORD(g_KaoOffsets->COMMUNICATOR_ARGS, KAOHACK_COMM_SKIP)

  return_value = TRUE;
  leave: {}
  return return_value;
}

/* ~~~~~~~~~~~~~~~~~~~~~~~~~~ */
BOOL
KaoMem_remoteMalloc(LPDWORD address, const DWORD size)
{
  BOOL return_value = FALSE;
  DWORD dwordTest;

  KAO_PUT_DWORD(
    (g_KaoOffsets->COMMUNICATOR_ARGS + 4 * 1),
    g_KaoOffsets->METHOD_MALLOC)

  KAO_PUT_DWORD(
    (g_KaoOffsets->COMMUNICATOR_ARGS + 4 * 2),
    size)

  KAO_PUT_DWORD(
    (g_KaoOffsets->COMMUNICATOR_ARGS + 4 * 0),
    ((1 << 3) | KAOHACK_COMM_CDECL))

  KAO_WAIT_DWORD_NE(
    (g_KaoOffsets->COMMUNICATOR_ARGS + 4 * 0),
    KAOHACK_COMM_WAITING)

  KAO_GET_DWORD(g_KaoOffsets->COMMUNICATOR_ARGS + 4 * 1)
  (*address) = dwordTest;

  return_value = TRUE;
  leave: {}
  return return_value;
}

/* ~~~~~~~~~~~~~~~~~~~~~~~~~~ */
BOOL
KaoMem_remoteMfree(const DWORD address)
{
  BOOL return_value = FALSE;
  DWORD dwordTest;

  KAO_PUT_DWORD(
    (g_KaoOffsets->COMMUNICATOR_ARGS + 4 * 1),
    g_KaoOffsets->METHOD_MFREE)

  KAO_PUT_DWORD(
    (g_KaoOffsets->COMMUNICATOR_ARGS + 4 * 2),
    address)

  KAO_PUT_DWORD(
    (g_KaoOffsets->COMMUNICATOR_ARGS + 4 * 0),
    ((1 << 3) | KAOHACK_COMM_CDECL))

  KAO_WAIT_DWORD_NE(
    (g_KaoOffsets->COMMUNICATOR_ARGS + 4 * 0),
    KAOHACK_COMM_WAITING)

  return_value = TRUE;
  leave: {}
  return return_value;
}

/* ~~~~~~~~~~~~~~~~~~~~~~~~~~ */
BOOL
KaoMem_readString(
  WCHAR unicodeResult[MEDIUM_BUF_SIZE],
  const DWORD stringWrapperAddress,
  const BOOL isUnicode)
{
  BOOL return_value = FALSE;
  DWORD dwordTest;
  DWORD stringBase;
  DWORD stringLength;
  CHAR ansiNodeName[MEDIUM_BUF_SIZE];

  KAO_GET_DWORD(stringWrapperAddress)
  stringBase = dwordTest;

  KAO_GET_DWORD(stringBase + 0x04)
  stringLength = (dwordTest > (MEDIUM_BUF_SIZE - 1)) ?
    (MEDIUM_BUF_SIZE - 1) :
    dwordTest;

  if (isUnicode)
  {
    TRY_BOOL(
      Kao_readMem(
        stringBase + 0x0C,
        unicodeResult,
        sizeof(WCHAR) * stringLength))

    unicodeResult[stringLength] = L'\0';
  }
  else
  {
    TRY_BOOL(
      Kao_readMem(
        stringBase + 0x0C,
        ansiNodeName,
        stringLength))

    ansiNodeName[stringLength] = '\0';

    TRY_BOOL(
      MultiByteToWideChar(
        1250,
        0,
        ansiNodeName,
        MEDIUM_BUF_SIZE,
        unicodeResult,
        MEDIUM_BUF_SIZE))
  }

  return_value = TRUE;
  leave: {}
  return return_value;
}

/* ~~~~~~~~~~~~~~~~~~~~~~~~~~ */
BOOL
KaoMem_readLevelName(
  WCHAR unicodeResult[MEDIUM_BUF_SIZE],
  const DWORD levelId)
{
  BOOL return_value = FALSE;
  DWORD dwordTest;

  KAO_GET_DWORD(g_KaoOffsets->GLOBAL_ARRAY_REF_LEVELDESC + 0x08);
  KAO_GET_DWORD(dwordTest + 0x04 * levelId);

  TRY_BOOL(
    KaoMem_readString(
      unicodeResult,
      (dwordTest + g_KaoOffsets->LEVELDESC_NAME),
      NE(KAO_GAMEVERSION_2PL, g_Kao_gameVersion)))

  return_value = TRUE;
  leave: {}
  return return_value;
}


/**************************************************************/

/**
 * @}
 */


/**************************************************************/
